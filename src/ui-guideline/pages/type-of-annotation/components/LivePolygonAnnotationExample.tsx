import { Contour, ContourViewer } from '@lunit/insight-viewer';
import React from 'react';
import { LiveEditor, LiveError, LivePreview, LiveProvider } from 'react-live';
import styled from 'styled-components';
import { LiveAnnotationExample } from '../../../components/examples/LiveAnnotationExample';

const initialContours: Contour[] = [
  {
    id: 1,
    polygon: [
      [130.24561403508773, 92.21052631578948],
      [129.34736842105264, 92.21052631578948],
      [124.8561403508772, 94.00701754385965],
      [122.16140350877193, 95.80350877192983],
      [115.87368421052632, 99.39649122807018],
      [113.17894736842105, 102.09122807017545],
      [101.50175438596492, 111.9719298245614],
      [97.01052631578948, 116.46315789473685],
      [87.12982456140351, 127.24210526315791],
      [83.53684210526316, 132.6315789473684],
      [79.04561403508772, 143.41052631578947],
      [78.14736842105263, 147.9017543859649],
      [78.14736842105263, 161.37543859649122],
      [80.84210526315789, 164.96842105263156],
      [91.62105263157895, 173.95087719298243],
      [96.11228070175439, 176.6456140350877],
      [108.68771929824561, 182.03508771929825],
      [118.56842105263158, 183.8315789473684],
      [138.3298245614035, 185.62807017543858],
      [147.3122807017544, 185.62807017543858],
      [164.37894736842105, 184.7298245614035],
      [174.25964912280702, 183.8315789473684],
      [189.5298245614035, 182.03508771929825],
      [198.51228070175438, 180.23859649122807],
      [204.8, 178.44210526315788],
      [220.96842105263158, 173.05263157894737],
      [223.66315789473686, 172.15438596491228],
      [230.84912280701755, 167.66315789473683],
      [234.4421052631579, 165.86666666666665],
      [238.03508771929825, 161.37543859649122],
      [239.83157894736843, 158.68070175438595],
      [240.72982456140352, 152.39298245614034],
      [240.72982456140352, 150.59649122807016],
      [241.6280701754386, 144.30877192982456],
      [241.6280701754386, 140.7157894736842],
      [241.6280701754386, 129.93684210526314],
      [241.6280701754386, 124.54736842105264],
      [239.83157894736843, 118.25964912280703],
      [238.93333333333334, 112.87017543859649],
      [236.23859649122807, 105.6842105263158],
      [235.34035087719298, 102.09122807017545],
      [233.54385964912282, 95.80350877192983],
      [232.64561403508773, 94.00701754385965],
      [229.05263157894737, 88.61754385964913],
      [228.15438596491228, 86.82105263157895],
      [223.66315789473686, 84.1263157894737],
      [222.76491228070176, 83.2280701754386],
      [217.37543859649122, 80.53333333333333],
      [214.68070175438598, 79.63508771929826],
      [208.39298245614034, 78.73684210526316],
      [203.90175438596492, 77.83859649122807],
      [201.20701754385965, 76.94035087719298],
      [193.12280701754386, 76.0421052631579],
      [186.83508771929826, 75.1438596491228],
      [181.44561403508771, 75.1438596491228],
      [178.75087719298247, 75.1438596491228],
      [175.1578947368421, 75.1438596491228],
      [173.36140350877193, 75.1438596491228],
      [171.56491228070175, 75.1438596491228],
      [170.66666666666666, 75.1438596491228],
      [169.7684210526316, 75.1438596491228],
    ],
  },
  {
    id: 2,
    polygon: [
      [355.70526315789476, 245.81052631578947],
      [355.70526315789476, 245.81052631578947],
      [351.2140350877193, 247.60701754385966],
      [349.41754385964913, 249.40350877192984],
      [343.1298245614035, 253.89473684210523],
      [337.740350877193, 257.4877192982456],
      [326.9614035087719, 267.3684210526316],
      [321.57192982456144, 273.6561403508772],
      [314.3859649122807, 282.6385964912281],
      [310.79298245614035, 288.02807017543864],
      [308.0982456140351, 297.9087719298246],
      [307.2, 302.40000000000003],
      [307.2, 309.5859649122807],
      [308.99649122807017, 314.97543859649124],
      [317.080701754386, 325.7543859649123],
      [322.47017543859647, 331.1438596491228],
      [335.9438596491228, 339.22807017543863],
      [344.9263157894737, 341.9228070175439],
      [364.6877192982456, 346.4140350877193],
      [371.87368421052633, 346.4140350877193],
      [386.2456140350877, 347.3122807017544],
      [392.53333333333336, 346.4140350877193],
      [401.5157894736842, 344.6175438596491],
      [408.70175438596493, 343.7192982456141],
      [416.7859649122807, 341.0245614035088],
      [419.48070175438596, 339.22807017543863],
      [426.6666666666667, 335.63508771929827],
      [430.25964912280705, 332.940350877193],
      [439.2421052631579, 324.85614035087724],
      [442.83508771929826, 322.16140350877197],
      [444.63157894736844, 320.3649122807018],
      [448.2245614035088, 314.07719298245615],
      [450.021052631579, 311.3824561403509],
      [450.919298245614, 305.9929824561404],
      [450.919298245614, 303.2982456140351],
      [450.021052631579, 296.1122807017544],
      [449.1228070175439, 291.62105263157895],
      [446.4280701754386, 282.6385964912281],
      [444.63157894736844, 279.04561403508774],
      [442.83508771929826, 273.6561403508772],
      [441.0385964912281, 270.0631578947369],
      [438.3438596491228, 263.77543859649126],
      [437.4456140350877, 261.9789473684211],
      [434.75087719298244, 257.4877192982456],
      [433.85263157894735, 255.6912280701754],
      [430.25964912280705, 252.0982456140351],
      [428.46315789473687, 250.30175438596493],
      [423.0736842105263, 245.81052631578947],
      [421.27719298245614, 244.91228070175438],
      [415.8877192982456, 243.1157894736842],
    ],
  },
  {
    id: 3,
    polygon: [
      [148.21052631578948, 348.2105263157895],
      [148.21052631578948, 348.2105263157895],
      [144.61754385964912, 349.10877192982457],
      [142.82105263157894, 350.90526315789475],
      [138.3298245614035, 354.4982456140351],
      [134.73684210526315, 357.1929824561404],
      [132.0421052631579, 359.88771929824566],
      [125.75438596491229, 367.0736842105263],
      [123.05964912280702, 370.6666666666667],
      [119.46666666666667, 378.7508771929825],
      [118.56842105263158, 382.3438596491228],
      [118.56842105263158, 391.3263157894737],
      [122.16140350877193, 397.61403508771934],
      [132.0421052631579, 409.29122807017546],
      [137.43157894736842, 414.680701754386],
      [149.10877192982457, 423.66315789473686],
      [159.88771929824563, 430.8491228070176],
      [174.25964912280702, 434.44210526315794],
      [179.64912280701753, 436.23859649122807],
      [198.51228070175438, 438.03508771929825],
      [204.8, 438.03508771929825],
      [220.0701754385965, 436.23859649122807],
      [225.459649122807, 434.44210526315794],
      [238.03508771929825, 430.8491228070176],
      [242.5263157894737, 428.1543859649123],
      [251.50877192982458, 422.76491228070176],
      [254.20350877192982, 420.0701754385965],
      [258.69473684210527, 413.7824561403509],
      [260.49122807017545, 410.18947368421055],
      [261.38947368421054, 400.30877192982456],
      [261.38947368421054, 394.9192982456141],
      [261.38947368421054, 383.2421052631579],
      [259.59298245614036, 376.9543859649123],
      [256.8982456140351, 372.46315789473687],
      [254.20350877192982, 367.0736842105263],
      [253.30526315789473, 363.48070175438596],
      [250.61052631578949, 358.98947368421057],
      [248.8140350877193, 357.1929824561404],
      [245.22105263157894, 353.6],
      [244.32280701754385, 351.80350877192984],
      [239.83157894736843, 349.10877192982457],
      [237.13684210526316, 346.4140350877193],
      [230.84912280701755, 343.7192982456141],
      [226.3578947368421, 341.9228070175439],
      [218.2736842105263, 339.22807017543863],
      [210.18947368421053, 338.32982456140354],
    ],
  },
];

function Example({ width, height, Viewer }: { width: number; height: number; Viewer: typeof ContourViewer }) {
  return (
    <LiveAnnotationExample width={width} height={height} initialContours={initialContours} contourMode="contour">
      {({ contours, cornerstoneRenderData, focusedContour }) => {
        return (
          <>
            {contours && contours.length > 0 && cornerstoneRenderData && (
              <Viewer
                width={width}
                height={height}
                contours={contours}
                focusedContour={focusedContour}
                cornerstoneRenderData={cornerstoneRenderData}
              />
            )}
          </>
        );
      }}
    </LiveAnnotationExample>
  );
}

const styleCode = `
const Viewer = styled(ContourViewer)\`
  [data-id="1"] {
    --contour-viewer-color: red;
    --contour-viewer-stroke-width: 5px;
  }
  
  [data-id="2"] {
    --contour-viewer-color: yellow;
    --contour-viewer-stroke-width: 2px;
  }
  
  polygon[data-id="2"] {
    stroke-dasharray: 6,4;
  }
\`;

render(<Example Viewer={Viewer} width={width} height={height} />);
`;

export function LivePolygonAnnotationExample({ width, height }: { width: number; height: number }) {
  return (
    <LiveProvider
      code={styleCode.trim()}
      scope={{
        ContourViewer,
        Example,
        styled,
        width,
        height,
      }}
      noInline
    >
      <div style={{ display: 'flex' }}>
        <LivePreview style={{ width }} />
        <div style={{ flex: 1 }}>
          <LiveEditor />
          <LiveError />
        </div>
      </div>
    </LiveProvider>
  );
}
